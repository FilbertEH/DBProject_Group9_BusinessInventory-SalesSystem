{% extends "base.html" %}
{% from 'components.html' import button %}

{% block content %}

<div class="container mx-auto max-w-5xl">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">ðŸ‘¥ Customers</h1>
    {% if current_user.is_admin() %}
      {{ button("+ Add Customer", href=url_for('add_customer_page'), class='font-bold') }}
    {% endif %}
  </div>

  {% if not current_user.is_admin() %}
    <p class="text-gray-600 text-sm mb-4">Customer add/delete is admin-only. You can edit existing customers.</p>
  {% endif %}

  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full leading-normal">
      <thead>
        <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
          <th class="py-3 px-6 text-left">ID</th>
          <th class="py-3 px-6 text-left">Name</th>
          <th class="py-3 px-6 text-left">Phone</th>
          <th class="py-3 px-6 text-left">Created At</th>
          <th class="py-3 px-6 text-center">Actions</th>
        </tr>
      </thead>

      <tbody class="text-gray-600 text-sm font-light">
        {% for c in customers %}
        <tr class="border-b border-gray-200 hover:bg-gray-50">
          <td class="py-3 px-6 text-left">{{ c.customer_id }}</td>
          <td class="py-3 px-6 text-left font-medium">{{ c.customer_name }}</td>
          <td class="py-3 px-6 text-left">{{ c.phone }}</td>
          <td class="py-3 px-6 text-left">{{ c.created_at.strftime('%Y-%m-%d %H:%M') if c.created_at else 'N/A' }}</td>
          <td class="py-3 px-6 text-center">
            {{ button("Edit", href=url_for('customer_edit', id=c.customer_id), variant='secondary', class='mr-2') }}
            {% if current_user.is_admin() %}
              <form method="post" action="{{ url_for('customer_delete', id=c.customer_id) }}"
                    onsubmit="return confirm('Delete this customer? This will fail if they have sales.');" class="inline">
                {{ button("Delete", type='submit', variant='danger') }}
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
