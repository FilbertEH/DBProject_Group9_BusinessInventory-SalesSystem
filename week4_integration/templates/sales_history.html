{% extends "base.html" %} {% from 'components.html' import button %} {% block
title %}Sales History - Inventory System{% endblock %} {% block content %}
<div class="container mx-auto max-w-5xl">
  <!-- Header Section -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      ðŸ“Š Sales Transaction History
    </h1>
    {{ button("+ Record New Sale", href=url_for('new_sale_form'), class='flex items-center gap-2 font-bold') }}
  </div>

  <!-- Sales Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    {% if sales %}
    <table class="min-w-full leading-normal">
      <thead>
        <tr class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
          <th class="py-3 px-6 text-left">ID</th>
          <th class="py-3 px-6 text-left">Date & Time</th>
          <th class="py-3 px-6 text-left">Customer</th>
          <th class="py-3 px-6 text-left">Operator</th>
          <th class="py-3 px-6 text-right">Total Amount</th>
        </tr>
      </thead>
      <tbody class="text-gray-600 text-sm font-light">
        {% for sale in sales %}

        <tr class="border-b border-gray-200">
          <td colspan="5" class="p-0">
            <details class="group">
              <summary
                class="cursor-pointer hover:bg-gray-50 transition list-none"
              >
                <div class="flex items-center py-3 px-6">
                  <div class="w-20 font-bold text-gray-800">#{{ sale.id }}</div>
                  <div class="w-48 text-gray-600">
                    {{ sale.date.strftime('%Y-%m-%d %H:%M') }}
                  </div>
                  <div class="flex-1 text-gray-600">
                    {% if sale.customer %}
                    <span
                      class="bg-blue-100 text-blue-800 py-1 px-3 rounded-full text-xs"
                    >
                      {{ sale.customer }}
                    </span>
                    {% else %}
                    <span class="text-gray-400 italic">Walk-in Customer</span>
                    {% endif %}
                  </div>
                  <div class="w-40 text-gray-600">{{ sale.operator }}</div>
                  <div
                    class="w-40 text-right font-bold text-green-600 text-base"
                  >
                    ${{ "%.2f"|format(sale.total) }}
                  </div>
                  <div class="w-8 text-gray-400 text-center">
                    <span
                      class="group-open:rotate-90 transition-transform inline-block"
                      >â–¶</span
                    >
                  </div>
                </div>
              </summary>

              <div class="bg-blue-50 px-6 py-4">
                <table class="min-w-full text-sm">
                  <thead>
                    <tr class="text-gray-600 text-xs uppercase">
                      <th class="text-left pb-2">Product</th>
                      <th class="text-center pb-2">Quantity</th>
                      <th class="text-right pb-2">Unit Price</th>
                      <th class="text-right pb-2">Subtotal</th>
                    </tr>
                  </thead>
                  <tbody class="text-gray-700">
                    {% for item in sale['items'] %}
                    <tr class="border-t border-blue-100">
                      <td class="py-2">{{ item[1] }}</td>
                      <td class="text-center">{{ item[2] }}</td>
                      <td class="text-right">${{ "%.2f"|format(item[3]) }}</td>
                      <td class="text-right font-semibold">
                        ${{ "%.2f"|format(item[4]) }}
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </details>
          </td>
        </tr>

        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <div class="p-10 text-center text-gray-500">
      <p class="text-xl mb-4">ðŸ“­ No transactions found.</p>
      <p>Click "Record New Sale" to start selling!</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
